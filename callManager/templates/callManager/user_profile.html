{% extends 'callManager/base.html' %}
{% block title %}User Profile - CallMan{% endblock %}
{% block content %}
    <div class="max-w-4xl mx-auto p-6 bg-card-bg rounded-lg shadow-md dark:bg-dark-card-bg dark:shadow-dark-shadow">
        <h1 class="text-2xl font-bold mb-4 text-text-heading dark:text-dark-text-primary">User Profile</h1>
        <h2 class="text-xl font-semibold mb-2 text-text-heading dark:text-dark-text-primary">Associated Companies</h2>
        {% if workers %}
            <ul class="mb-4 space-y-2 text-text-tertiary dark:text-dark-text-tertiary">
                {% for worker in workers %}
                    <li>{{ worker.company.name }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary dark:text-dark-text-secondary mb-4">No associated workers found.</p>
        {% endif %}
        <h2 class="text-xl font-semibold mb-2 text-text-heading dark:text-dark-text-primary">Your Calls</h2>
        {% if upcoming %}
            <ul class="space-y-2">
                {% for request in upcoming %}
                    <li class="border-b py-2 text-text-tertiary dark:text-dark-text-tertiary dark:border-dark-border-dark">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-md font-semibold">{{ request.labor_requirement.call_time.event.company.name }} - 
                                {{ request.labor_requirement.call_time.event.event_name }}</p>
                                <p class="text-sm">{{ request.labor_requirement.call_time.event.location_profile.name }} - {{ request.labor_requirement.call_time.name }} - {{ request.labor_requirement.labor_type.name }}</p>
                                <p class="text-text-secondary dark:text-dark-text-secondary">
                                    {{ request.labor_requirement.call_time.date }} at {{ request.labor_requirement.call_time.time|time:"h:i A" }}
                                </p>
                                <p class="text-sm text-text-tertiary dark:text-dark-text-tertiary">{{ request.labor_requirement.call_time.message }}</p>
                            </div>
                            <div class="text-right flex items-center space-x-2">
                                <span class="inline-block px-2 py-1 rounded text-sm
                                    {% if request.availability_response is null and not request.confirmed %}bg-yellow-100 text-yellow-800 dark:bg-dark-conflict-yellow dark:text-dark-text-yellow
                                    {% elif request.availability_response == 'yes' and request.confirmed %}bg-green-100 text-green-800 dark:bg-dark-success dark:text-dark-text-green
                                    {% elif request.availability_response == 'no' %}bg-red-100 text-red-800 dark:bg-dark-danger dark:text-dark-text-red
                                    {% else %}bg-bg-available text-gray-800 dark:bg-dark-bg-available dark:text-dark-gray-900{% endif %}">
                                    {% if request.availability_response is null and not request.confirmed %}
                                        Pending
                                    {% elif request.availability_response == 'yes' and request.confirmed %}
                                        Confirmed
                                    {% elif request.availability_response == 'no' %}
                                        Declined
                                    {% else %}
                                        Available - Awaiting Confirmation
                                    {% endif %}
                                </span>
                                {% if request.availability_response is null and not request.confirmed %}
                                    <form method="post" action="{% url 'labor_request_action' request.id 'confirm' %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="bg-success text-dark-text-primary px-2 py-1 rounded hover:bg-success-hover dark:bg-dark-success dark:hover:bg-dark-success-hover text-sm">Confirm Availability</button>
                                    </form>
                                    <form method="post" action="{% url 'labor_request_action' request.id 'decline' %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="bg-danger text-dark-text-primary px-2 py-1 rounded hover:bg-danger-hover dark:bg-dark-danger dark:hover:bg-dark-danger-hover text-sm">Decline</button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary dark:text-dark-text-secondary">No gigs found.</p>
        {% endif %}
        {% if past %}
            <h2 class="pt-10 text-xl font-semibold mb-2 text-text-heading dark:text-dark-text-primary">Past Shows</h2>
            <ul class="space-y-2">
                {% for request in past %}
                    <li class="border-b py-2 text-text-tertiary dark:text-dark-text-tertiary dark:border-dark-border-dark">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-md font-semibold">{{ request.labor_requirement.call_time.event.company.name }} -
                                {{ request.labor_requirement.call_time.event.event_name }}</p>
                                <p class="text-sm">{{ request.labor_requirement.call_time.event.location_profile.name }} - {{ request.labor_requirement.call_time.name }} - {{ request.labor_requirement.labor_type.name }}</p>
                                <p class="text-text-secondary dark:text-dark-text-secondary">
                                    {{ request.labor_requirement.call_time.date }} at {{ request.labor_requirement.call_time.time|time:"h:i A" }}
                                </p>
                                <p class="text-sm text-text-tertiary dark:text-dark-text-tertiary">{{ request.labor_requirement.call_time.message }}</p>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
{% endblock %}
