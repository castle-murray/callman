{% extends 'callManager/base.html' %}

{% block title %}Call Time Requests - CallMan{% endblock %}

{% block content %}
    <h1 class="text-2xl font-bold mb-6">Requests for {{ call_time.name }} at {{ call_time.time }} on {{ call_time.date }}</h1>
    <div class="bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto">
        <!-- Filter Dropdown -->
        <div class="mb-6">
            <form method="get">
                <label for="labor_type" class="text-lg font-semibold mr-2">Filter by Labor Type:</label>
                <select name="labor_type" id="labor_type" class="p-2 border rounded" onchange="this.form.submit()">
                    <option value="All" {% if selected_labor_type == 'All' %}selected{% endif %}>All</option>
                    {% for labor_type in labor_types %}
                        <option value="{{ labor_type.id }}" {% if selected_labor_type == labor_type.id|stringformat:"s" %}selected{% endif %}>{{ labor_type.name }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>

        <h2 class="text-xl font-semibold mb-2 text-yellow-600">Pending Requests</h2>
        {% if pending_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in pending_requests %}
                    <li class="flex items-center justify-between text-yellow-600">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="confirm">
                                <button type="submit" class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">Confirm</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="decline">
                                <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Decline</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-600 mb-4">No pending requests.</p>
        {% endif %}

        <h2 class="text-xl font-semibold mb-2 text-green-600">Confirmed Requests</h2>
        {% if confirmed_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in confirmed_requests %}
                    <li class="flex items-center justify-between text-green-600">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="decline">
                                <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Decline</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-600 mb-4">No confirmed requests.</p>
        {% endif %}

        <h2 class="text-xl font-semibold mb-2 text-red-600">Declined Requests</h2>
        {% if declined_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in declined_requests %}
                    <li class="flex items-center justify-between text-red-600">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="confirm">
                                <button type="submit" class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">Confirm</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-600 mb-4">No declined requests.</p>
        {% endif %}

        <a href="{% url 'event_detail' call_time.event.slug %}" class="mt-4 inline-block text-blue-500 hover:underline">Back to Event</a>
    </div>
{% endblock %}
