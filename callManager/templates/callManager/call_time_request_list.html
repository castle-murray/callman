{% extends 'callManager/base.html' %}

{% block title %}Call Time Requests - CallMan{% endblock %}

{% block content %}
    <h1 class="text-2xl font-bold mb-6 text-text-heading dark:text-dark-text-primary">Requests for {{ call_time.name }} at {{ call_time.time }} on {{ call_time.date }}</h1>
    {% if messages %}
    {% for message in messages %}
    <p class="text-text-green mt-2 dark:text-dark-text-green">{{ message }}</p>
    {% endfor %}
    {% endif %}
    <div class="bg-card-bg p-6 rounded-lg shadow-md max-w-4xl mx-auto dark:bg-dark-card-bg dark:shadow-dark-shadow">
        <!-- Filter Dropdown -->
        <div class="mb-6">
            <form method="get">
                <label for="labor_type" class="text-lg font-semibold mr-2 text-text-heading dark:text-dark-text-primary">Filter by Labor Type:</label>
                <select name="labor_type" id="labor_type" class="p-2 border rounded bg-card-bg text-text-tertiary dark:bg-dark-card-bg dark:text-dark-text-tertiary dark:border-dark-border" onchange="this.form.submit()">
                    <option value="All" {% if selected_labor_type == 'All' %}selected{% endif %}>All</option>
                    {% for labor_type in labor_types %}
                        <option value="{{ labor_type.id }}" {% if selected_labor_type == labor_type.id|stringformat:"s" %}selected{% endif %}>{{ labor_type.name }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>

        <h2 class="text-xl font-semibold mb-2 text-text-yellow dark:text-dark-text-yellow">Pending Requests</h2>
        {% if pending_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in pending_requests %}
                    <li class="flex items-center justify-between text-text-yellow dark:text-dark-text-yellow">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) {% if request.worker.nocallnoshow >= 2 %}<span class="text-purple dark:text-dark-purple">{{ request.worker.nocallnoshow }} NCNS</span>{% endif %} - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="confirm">
                                <button type="submit" class="bg-success text-dark-text-primary px-2 py-1 rounded hover:bg-success-hover dark:bg-dark-success dark:hover:bg-dark-success-hover">Confirm</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="decline">
                                <button type="submit" class="bg-danger text-dark-text-primary px-2 py-1 rounded hover:bg-danger-hover dark:bg-dark-danger dark:hover:bg-dark-danger-hover">Decline</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-secondary text-dark-text-primary px-2 py-1 rounded hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary mb-4 dark:text-dark-text-secondary">No pending requests.</p>
        {% endif %}

        <h2 class="text-xl font-semibold mb-2 text-text-green dark:text-dark-text-green">Confirmed Requests</h2>
        {% if confirmed_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in confirmed_requests %}
                    <li class="flex items-center justify-between text-text-green dark:text-dark-text-green">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) {% if request.worker.nocallnoshow >= 2 %}<span class="text-purple dark:text-dark-purple">{{ request.worker.nocallnoshow }} NCNS</span>{% endif %} - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="decline">
                                <button type="submit" class="bg-danger text-dark-text-primary px-2 py-1 rounded hover:bg-danger-hover dark:bg-dark-danger dark:hover:bg-dark-danger-hover">Decline</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="ncns">
                                <button type="submit" class="bg-purple text-dark-text-primary px-2 py-1 rounded hover:bg-purple-hover dark:bg-dark-purple dark:hover:bg-dark-purple-hover">NCNS</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-secondary text-dark-text-primary px-2 py-1 rounded hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary mb-4 dark:text-dark-text-secondary">No confirmed requests.</p>
        {% endif %}

        <h2 class="text-xl font-semibold mb-2 text-text-red dark:text-dark-text-red">Declined Requests</h2>
        {% if declined_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in declined_requests %}
                    <li class="flex items-center justify-between text-text-red dark:text-dark-text-red">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) {% if request.worker.nocallnoshow >= 2 %}<span class="text-purple dark:text-dark-purple">{{ request.worker.nocallnoshow }} NCNS</span>{% endif %} - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="confirm">
                                <button type="submit" class="bg-success text-dark-text-primary px-2 py-1 rounded hover:bg-success-hover dark:bg-dark-success dark:hover:bg-dark-success-hover">Confirm</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-secondary text-dark-text-primary px-2 py-1 rounded hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary mb-4 dark:text-dark-text-secondary">No declined requests.</p>
        {% endif %}

        <h2 class="text-xl font-semibold mb-2 text-purple dark:text-dark-purple">No Call No Show</h2>
        {% if ncns_requests %}
            <ul class="space-y-2 mb-4">
                {% for request in ncns_requests %}
                    <li class="flex items-center justify-between text-purple dark:text-dark-purple">
                        {{ request.worker.name|default:"Unnamed Worker" }} ({{ request.worker.phone_number }}) {% if request.worker.nocallnoshow >= 2 %}<span class="text-purple dark:text-dark-purple">{{ request.worker.nocallnoshow }} NCNS</span>{% endif %} - {{ request.labor_requirement.labor_type.name }}
                        <div>
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="confirm">
                                <button type="submit" class="bg-success text-dark-text-primary px-2 py-1 rounded hover:bg-success-hover dark:bg-dark-success dark:hover:bg-dark-success-hover">Confirm</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="decline">
                                <button type="submit" class="bg-danger text-dark-text-primary px-2 py-1 rounded hover:bg-danger-hover dark:bg-dark-danger dark:hover:bg-dark-danger-hover">Decline</button>
                            </form>
                            <form method="post" class="inline ml-2">
                                {% csrf_token %}
                                <input type="hidden" name="request_id" value="{{ request.id }}">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="bg-secondary text-dark-text-primary px-2 py-1 rounded hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-text-secondary mb-4 dark:text-dark-text-secondary">No no-call no-show requests.</p>
        {% endif %}

        <a href="{% url 'event_detail' call_time.event.slug %}" class="mt-4 inline-block text-primary hover:underline dark:text-dark-text-blue dark:hover:text-dark-primary-hover">Back to Event</a>
    </div>
{% endblock %}
